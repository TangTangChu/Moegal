/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.37.0.
 * Original file: /npm/@mdit/plugin-footnote@0.16.0/lib/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const e=(e,o)=>e[o].meta.subId>0?`:${e[o].meta.subId}`:"",o=(e,o,t,n)=>`${"string"==typeof n.docId?`-${n.docId}-`:""}${(e[o].meta.id+1).toString()}`,t=(o,t)=>`[${(o[t].meta.id+1).toString()}${e(o,t)}]`,n=(o,t,n,r,s)=>{const l=s.rules.footnote_anchorName(o,t,n,r,s);return`<sup class="footnote-ref"><a href="#footnote${l}">${s.rules.footnote_caption(o,t,n,r,s)}</a><a class="footnote-anchor" id="footnote-ref${l}${e(o,t)}" /></sup>`},r=(e,o,t)=>`<hr class="footnotes-sep"${t.xhtmlOut?" /":""}>\n<section class="footnotes">\n<ol class="footnotes-list">\n`,s=()=>"</ol>\n</section>\n",l=(o,t,n,r,s)=>`<li id="footnote${s.rules.footnote_anchorName(o,t,n,r,s)}${e(o,t)}" class="footnote-item">`,c=()=>"</li>\n",f=(o,t,n,r,s)=>` <a href="#footnote-ref${s.rules.footnote_anchorName(o,t,n,r,s)}${e(o,t)}" class="footnote-backref">↩︎</a>`,a=(e,o,t,n)=>{const r=e.bMarks[o]+e.tShift[o],s=e.eMarks[o];if(r+4>s||"["!==e.src.charAt(r)||"^"!==e.src.charAt(r+1))return!1;let l=r+2;for(;l<s;){if(" "===e.src.charAt(l))return!1;if("]"===e.src.charAt(l))break;l++}if(l===r+2||l+1>=s||":"!==e.src.charAt(++l))return!1;if(n)return!0;l++,(e.env.footnotes??={}).refs??={};const c=e.src.slice(r+2,l-2);e.env.footnotes.refs[`:${c}`]=-1;const f=e.push("footnote_reference_open","",1);f.meta={label:c},f.level=e.level++;const a=e.bMarks[o],i=e.tShift[o],u=e.sCount[o],p=e.parentType,h=l,k=e.sCount[o]+l-(e.bMarks[o]+e.tShift[o]);let b=e.sCount[o]+l-(e.bMarks[o]+e.tShift[o]);for(;l<s;){const o=e.src.charAt(l);if("\t"===o)b+=4-b%4;else{if(" "!==o)break;b++}l++}e.tShift[o]=l-h,e.sCount[o]=b-k,e.bMarks[o]=h,e.blkIndent+=4,e.parentType="footnote",e.sCount[o]<e.blkIndent&&(e.sCount[o]+=e.blkIndent),e.md.block.tokenize(e,o,t),e.parentType=p,e.blkIndent-=4,e.tShift[o]=i,e.sCount[o]=u,e.bMarks[o]=a;return e.push("footnote_reference_close","",-1).level=--e.level,!0},i=(e,o)=>{const t=e.posMax,n=e.pos;if(n+2>=t||"^"!==e.src.charAt(n)||"["!==e.src.charAt(n+1))return!1;const r=e.md.helpers.parseLinkLabel(e,n+1);if(r<0)return!1;const s=n+2;if(!o){const o=((e.env.footnotes??={}).list??=[]).length,t=[];e.md.inline.parse(e.src.slice(s,r),e.md,e.env,t);e.push("footnote_ref","",0).meta={id:o},e.env.footnotes.list[o]={content:e.src.slice(s,r),tokens:t}}return e.pos=r+1,e.posMax=t,!0},u=(e,o)=>{const t=e.pos,n=e.posMax;if(t+3>n||!e.env.footnotes?.refs||"["!==e.src.charAt(t)||"^"!==e.src.charAt(t+1))return!1;let r=t+2;for(;r<n;){if(" "===e.src.charAt(r)||"\n"===e.src.charAt(r))return!1;if("]"===e.src.charAt(r))break;r++}if(r===t+2||r>=n)return!1;r++;const s=e.src.slice(t+2,r-1);if(typeof e.env.footnotes.refs[`:${s}`]>"u")return!1;if(!o){const o=e.env.footnotes.list??=[],{refs:t}=e.env.footnotes;let n;t[`:${s}`]<0?(n=o.length,o[n]={label:s,count:0},t[`:${s}`]=n):n=t[`:${s}`];const r=o[n].count;o[n].count=o[n].count+1;e.push("footnote_ref","",0).meta={id:n,subId:r,label:s}}return e.pos=r,e.posMax=n,!0},p=e=>{const o={};let t,n,r=!1;if(!e.env.footnotes?.list)return!1;const{list:s}=e.env.footnotes;e.tokens=e.tokens.filter((e=>"footnote_reference_open"===e.type?(r=!0,t=[],n=e.meta.label,!1):"footnote_reference_close"===e.type?(r=!1,o[`:${n}`]=t,!1):(r&&t.push(e),!r)));const l=new e.Token("footnote_block_open","",1);e.tokens.push(l);for(let t=0,{length:n}=s;t<n;t++){const n=new e.Token("footnote_open","",1);let r;if(n.meta={id:t,label:s[t].label},e.tokens.push(n),s[t].tokens){const o=new e.Token("paragraph_open","p",1);o.block=!0;const n=new e.Token("inline","",0);n.children=s[t].tokens,n.content=s[t].content;const r=new e.Token("paragraph_close","p",-1);r.block=!0,e.tokens.push(o,n,r)}else if(s[t].label){const n=o[`:${s[t].label}`];n&&e.tokens.push(...n)}r="paragraph_close"===e.tokens[e.tokens.length-1].type?e.tokens.pop()??null:null;for(let o=0;o<(Number(s[t].count)>0?s[t].count:1);o++){const n=new e.Token("footnote_anchor","",0);n.meta={id:t,subId:o,label:s[t].label},e.tokens.push(n)}r&&e.tokens.push(r),e.tokens.push(new e.Token("footnote_close","",-1))}return e.tokens.push(new e.Token("footnote_block_close","",-1)),!0},h=e=>{e.renderer.rules.footnote_ref=n,e.renderer.rules.footnote_block_open=r,e.renderer.rules.footnote_block_close=s,e.renderer.rules.footnote_open=l,e.renderer.rules.footnote_close=c,e.renderer.rules.footnote_anchor=f,e.renderer.rules.footnote_caption=t,e.renderer.rules.footnote_anchorName=o,e.block.ruler.before("reference","footnoteDef",a,{alt:["paragraph","reference"]}),e.inline.ruler.after("image","footnoteInline",i),e.inline.ruler.after("footnoteInline","footnote_ref",u),e.core.ruler.after("inline","footnoteTail",p)};export{h as footnote};export default null;
//# sourceMappingURL=/sm/a78a6c2e59d5a2af493c7c42a72bd245b595b013fea33634deb3d587162d11fe.map